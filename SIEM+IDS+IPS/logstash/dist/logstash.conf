input {
    beats {
        port => 5044
    }
}

# Filter firewall
filter {
  if [type] == "WP" {
        grok {
                match => [
                "message", "\[%{MONTHDAY:day}-%{MONTH:month}-%{YEAR:year} %{TIME:time} %{WORD:zone}\] PHP %{DATA:level}\:  %{GREEDYDATA:error}"
                ]
        }
        mutate {
                add_field => [ "timestamp", "%{year}-%{month}-%{day} %{time}" ]
                remove_field => [ "zone", "month", "day", "time" ,"year"]
        }
        date {
                match => [ "timestamp" , "yyyy-MMM-dd HH:mm:ss" ]
                remove_field => [ "timestamp" ]
        }
   }
  if [source] =~ "firewall.logtest" {
          grok {
                  match => {"message" => "\[UFW%{SPACE}%{GREEDYDATA:flag}\] IN=%{GREEDYDATA:IN} OUT=%{GREEDYDATA:OUT}
                  SRC=%%{IP:origen} DST=%{IP:destino}"}
          }
  }
}
output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    manage_template => false
    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"
  }
}